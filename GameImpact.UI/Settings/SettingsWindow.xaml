<Window x:Class="GameImpact.UI.Settings.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="设置" Height="560" Width="640"
        MinHeight="400" MinWidth="500"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- TreeViewItem 自定义样式：扁平化导航风格 -->
        <Style x:Key="NavTreeViewItem" TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="{DynamicResource AppTextSecondary}" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="IsExpanded" Value="True" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
            <!-- 递归应用到子级 TreeViewItem -->
            <Setter Property="ItemContainerStyle" Value="{DynamicResource NavTreeViewItem}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <StackPanel>
                            <!-- 当前项的 Header -->
                            <Border x:Name="ItemBorder" Background="Transparent"
                                    CornerRadius="6" Padding="12,8" Margin="0,1">
                                <TextBlock x:Name="HeaderText"
                                           Text="{TemplateBinding Header}"
                                           Foreground="{DynamicResource AppTextSecondary}"
                                           FontSize="13" FontWeight="Normal" />
                            </Border>
                            <!-- 子项容器（缩进） -->
                            <ItemsPresenter x:Name="ItemsHost" Margin="16,0,0,0" />
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed" />
                            </Trigger>
                            <!-- 使用 Border 自身的 IsMouseOver 避免父子项同时高亮 -->
                            <DataTrigger Binding="{Binding IsMouseOver, ElementName=ItemBorder}" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background"
                                        Value="{DynamicResource AppSurfaceVariant}" />
                            </DataTrigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ItemBorder" Property="Background"
                                        Value="{DynamicResource AppSurfaceVariant}" />
                                <Setter TargetName="HeaderText" Property="Foreground"
                                        Value="{DynamicResource AppAccent}" />
                                <Setter TargetName="HeaderText" Property="FontWeight"
                                        Value="SemiBold" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="{DynamicResource AppBackground}" CornerRadius="8"
            BorderBrush="{DynamicResource AppBorder}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="44" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 标题栏 -->
            <Border Grid.Row="0" Background="{DynamicResource AppSurface}" CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                        <TextBlock Text="⚙" FontSize="16" Foreground="{DynamicResource AppAccent}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="设置" FontSize="13" FontWeight="SemiBold"
                                   Foreground="{DynamicResource AppText}" Margin="8,0,0,0"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <Button Grid.Column="1" Style="{DynamicResource WindowCloseButton}"
                            Click="Close_Click" ToolTip="关闭">
                        <TextBlock Text="✕" FontSize="11" />
                    </Button>
                </Grid>
            </Border>

            <!-- 主体内容：左侧导航 + 右侧内容区 -->
            <Grid Grid.Row="1" Margin="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="170" />
                    <ColumnDefinition Width="1" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- 左侧树形导航 -->
                <TreeView x:Name="NavTree" Grid.Column="0"
                          Background="Transparent" BorderThickness="0"
                          Padding="8,12" Margin="0"
                          SelectedItemChanged="OnNavTreeSelectedItemChanged">
                    <TreeView.ItemContainerStyle>
                        <StaticResource ResourceKey="NavTreeViewItem" />
                    </TreeView.ItemContainerStyle>
                </TreeView>

                <!-- 分隔线 -->
                <Border Grid.Column="1" Background="{DynamicResource AppBorderSubtle}" />

                <!-- 右侧内容区 -->
                <ContentControl x:Name="ContentHost" Grid.Column="2" Margin="20,16,16,16" />
            </Grid>
        </Grid>
    </Border>
</Window>
