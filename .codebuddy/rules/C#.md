---
# 注意不要修改本文头文件，如修改，CodeBuddy（内网版）将按照默认逻辑设置
type: always
---
你是一个专业的C#开发助手，所有代码必须严格遵循以下编码规范。

## 等级说明
- 【必须】：必须采用（除非是少数非常特殊的情况，才能不采用）
- 【推荐】：理应采用，但如有特殊情况，可以不采用
- 【可选】：应该参考，自行决定是否采用

## 命名规范

### 变量命名
- 【必须】所有文件、类、变量等命名都须用英文拼写，不使用汉语拼音、不使用数字命名
- 【必须】函数名、变量名、类名都必须具有描述性，尽量不用缩写
- 【必须】变量命名须一目了然，与功能相符（如：enablePool、serverNum）
- 【必须】变量类型不需加类型前缀，小驼峰命名（如：count、passTime、enable）
- 【推荐】private/protected成员变量使用m_作为前缀（public型不加前缀），后接小驼峰变量名（如：int m_poolCount = 1;）
- 【推荐】private/protected静态成员变量使用s_作为前缀（public型不加前缀），后接小驼峰变量名（如：static bool s_enablePool = false;）

### 类型命名
- 【必须】类、结构体使用大驼峰命名，若以单独文件保存，则文件命名与类名、结构体名相同
- 【必须】枚举类型及其枚举值，皆为大驼峰命名
- 【必须】宏使用大写蛇形式命名（如：#if BEHAVIAC_RELEASE）
- 【必须】接口以大写字母I开头，后接大驼峰命名（如：public interface IComponent）

### 其他命名
- 【必须】函数使用大驼峰命名，命名与功能相符（如：CreateMonster()、ReleaseActorPool()）
- 【推荐】公共属性使用大驼峰命名法，不应再以Set/Get开头
- 【推荐】常量使用大驼峰命名（如：const int PoolMaxCount = 1;）
- 【必须】文件使用大驼峰命名，文件中定义的第一个类型必须是与文件同名的public或internal类型
- 【必须】命名空间命名应简单，大驼峰命名，可用简写
- 【必须】文件夹使用大驼峰命名

## 代码外观规范

### 格式要求
- 【必须】一个Tab为4个空格
- 【必须】代码文件必须以UTF-8 without BOM格式进行存储
- 【必须】一行只做一个变量声明，不允许int count, total;这样的写法

### 空行使用
- 【必须】以下情况需使用空行：
    - 接口、类、枚举定义之间
    - 函数与函数之间
    - 函数中变量声明与使用之间
    - 函数中不同的逻辑之间
    - 函数中的return与其它语句之间
    - 注释与它注释的语句间不空行，但与其它语句间需空行

### 空格使用
- 【必须】以下情况需使用空格：
    - 关键字和左括符"("之间（如：while (true)、if (true)）
    - 函数名和左括符"("之间不应使用空格
    - 函数多个参数间用逗号隔开，每个逗号后应加一个空格
    - 除.之外，二元操作符都用空格与操作数隔开，一元操作符不需用空格隔开

### 花括号使用
- 【必须】左花括号"{"放于关键字或函数名的下一行并与之对齐
- 【必须】左花括号要与对应的右花括号对齐，且单独成一行
- 【必须】if、while语句后要加{}，即使{}号中只有一条语句

### 注释规范
- 【必须】在类、接口、函数前应使用标准C# XML文档注释格式（///）
- 【必须】函数内注释使用单行注释，临时的、有争议的、待改进的代码处也需要注释

### var声明
- 【必须】仅三种情况下可以使用var关键字：
    - 从单条语句可明确看出来变量类型
    - 定义linq的返回值类型
    - 要使用匿名类型

### 命名空间
- 【必须】禁止在全局命名空间声明类型

## 通用代码实践

### 字符串处理
- 【必须】大量字符串拼接时(多于10个)，优先使用StringBuilder
- 【必须】避免使用ToLower()、ToUpper()来消除大小写敏感，调用次数较多时，GC内存分配较多

### 字符串格式化
- 【推荐】使用string.Format时，应显式对值类型进行ToString()转换，避免装箱操作
- 【推荐】如果编译器支持C#6及以上语法，优先使用字符串插值($)语法糖

### bool条件判断
- 【推荐】应将开销较小、更易满足的条件往前放
- 【推荐】条件较多时，应分行书写

### delegate缓存
- 【推荐】对于函数转为Delegate，如频率较高，都应cache好方法对应的Delegate

### 泛型使用
- 【推荐】最好避免定义新的值类型/枚举类型的泛型，而使用少数几个公用的泛型
- 【必须】Dictionary<TKey, TValue>的TKey、List<T>的T，如是没有实现IEquatable<T>的值类型或Enum时，必须为容器构造函数里传入Custom Comparer

### struct优化
- 【推荐】struct重写掉Equals()、GetHashCode()、ToString()，实现IEquatable接口
- 【必须】频繁使用的小数据类型尽量声明为struct

### 其他实践
- 【必须】避免使用goto语句，可通过do {} while (false);来解决跳出层次较深的语块
- 【推荐】成员变量声明时，尽可能赋予初始值，但要避免对实例方法的引用；字符串成员变量初始化为string.Empty，避免null reference
- 【推荐】合理使用Dictionary.TryGetValue方法，避免产生两次查询；C#6及以上版本推荐直接在TryGetValue方法内申明变量
- 【推荐】避免XmlNode.Count/ChildNodes[]/Attributes的开销，优先使用foreach遍历而非for循环
- 【推荐】使用XML作为配置文件时，避免将XmlNode直接缓存，用自定义结构缓存需要的数据
- 【推荐】优先使用扩展方法而不仅是普通静态方法，能有效提升代码可读性

## Unity代码实践

### 生命周期函数
- 【必须】基本的生命周期函数要严格确保大小写、拼写正确
- 【必须】未使用的生命周期函数不要声明，尤其是Update()、LateUpdate()等高频函数

### Update函数
- 【推荐】禁止写空Update()函数
- 【推荐】禁止在Update函数中进行一些明显有问题的操作（如new操作符、无条件字符串拼接、GetComponent等）

### 空引用保护
- 【必须】避免不合理的空引用保护，如有不得不进行保护的情况，则必须加上错误日志

### 其他Unity实践
- 【推荐】错误日志：准确使用Log级别，不要把一般性Log打印为Error级别；不要输出无意义Log；考虑输出频率，不要出现高频Log
- 【必须】需在不同平台生效的代码，严格用宏限定（如：#if UNITY_ANDROID）
- 【推荐】函数裁剪：项目设置StrippingLevel和API兼容级别时，需在link.xml中手动添加裁掉的类
- 【必须】禁止私自接入第三方组件，需经项目组确认无版权问题后充分测试方可接入
- 【可选】谨慎使用LINQ，由于GC内存分配较大，需了解具体实现细节
- 【推荐】使用协程时，尽量为YieldInstruction的协程对象（如WaitForSeconds）进行cache，防止多次创建对象
- 【推荐】避免使用SendMessage()，如过分滥用会造成性能降低，应设计其他方式取代（如接口）
- 【推荐】避免使用静态变量引用Unity资源，若不手动解除引用则资源不会被释放，造成内存占用
- 【推荐】保持属性的实现足够轻量，如需执行复杂逻辑，建议改为Set/Get开头的大写驼峰式函数

## .NET Core代码实践

### 异常处理
- 【必须】抛出异常而不是使用错误码，不要设计public方法可以通过参数指定抛出异常或不抛出异常，不要设计public方法返回异常
- 【推荐】创建和抛出自定义异常而不是通用异常，选择抛出正确类型的异常

### Attributes
- 【必须】Attribute类型以"Attribute"结尾
- 【推荐】Attribute应该添加[AttributeUsage]
- 【推荐】可选参数提供set属性
- 【必须】必选参数只提供get属性

### 其他.NET Core实践
- 【推荐】属性应当避免Is开头（特别是DTO类）
- 【推荐】优先使用DateTimeOffset而不是DateTime
- 【推荐】优先使用XDocument, XElement而不是XmlDocument, XmlElement

## 路径和region
- 【推荐】使用Unix风格的路径，即使用/而非\\作为目录分隔符；目录路径结尾包含/以避免不必要的字符串拼接
- 【可选】合理使用#region来进行代码分段与描述，提高可读性

## 历史规范（仅适用于已存在项目）
以下规范为历史（Obsolete）、有争议（Disputable）规范，仅适用于已存在的项目，新项目不应采用：
- 变量类型：变量命名需加类型前缀，前缀小写，变量名首字母大写（如：iCount、fPassTime、bEnable）
- 常量：使用c_作为前缀，后面接变量类型和变量名（如：const int c_iPoolMaxCount = 1）
- 枚举：大写蛇形命名法（如：BEGIN_LOAD_SCENE、AFTER_LOAD_SCENE）
